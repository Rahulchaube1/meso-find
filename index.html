<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSME AI Pitch Generator - Tamil Nadu</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a futuristic feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the AI theme */
        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #0a0a0a;
            color: #e0e0e0;
            overflow: hidden; /* Hide scrollbars from canvas overflow */
        }

        h1, h2 {
            font-family: 'Orbitron', sans-serif;
        }

        /* Canvas for the animated background */
        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
        }

        /* Main content container */
        .main-content {
            position: relative;
            z-index: 1;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        /* Custom button styling with glow effect */
        .ai-button {
            background: linear-gradient(45deg, #00ffff, #6a0dad);
            border: none;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), 0 0 20px rgba(106, 13, 173, 0.5);
            transition: all 0.3s ease-in-out;
        }

        .ai-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8), 0 0 30px rgba(106, 13, 173, 0.8);
        }
        
        .ai-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Loading spinner */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #00ffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Blinking cursor for typewriter effect */
        .blinking-cursor {
            font-weight: bold;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        /* Search input styling */
        .search-input {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #e0e0e0;
        }
        .search-input:focus {
            outline: none;
            border-color: rgba(0, 255, 255, 0.8);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <!-- Animated background canvas -->
    <canvas id="matrix-canvas"></canvas>

    <!-- Main content area -->
    <div class="main-content w-full max-w-4xl p-8 rounded-xl shadow-2xl text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-cyan-300 mb-4">MSME Data & AI Pitch Generator</h1>
        <p class="text-gray-400 mb-8 max-w-2xl mx-auto">
            Initiate data extraction for Tamil Nadu MSME registrations. Our internal AI will then analyze the Chennai data and construct a compelling business pitch.
        </p>
        
        <button id="fetchBtn" class="ai-button text-white font-bold py-3 px-8 rounded-lg text-lg flex items-center justify-center mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
            Analyze & Generate Pitch
        </button>
        
        <div id="loading" class="hidden flex flex-col items-center justify-center mt-8">
            <div class="loader"></div>
            <p class="text-cyan-300 mt-4">Accessing Data Stream... Please Wait.</p>
        </div>
        
        <div id="output" class="mt-8 text-left"></div>
    </div>

    <script>
        // --- Configuration ---
        const scraperApiKey = '3a38b6c6a878ba8ee5792ba6e40379ae';
        const msmeUrl = 'https://dashboard.msme.gov.in/uam_dist_wise.aspx?stid=33';

        // --- DOM Element References ---
        const fetchBtn = document.getElementById('fetchBtn');
        const loadingDiv = document.getElementById('loading');
        const outputDiv = document.getElementById('output');
        
        // --- Data Store ---
        let allDistrictsData = [];

        // --- Typewriter Effect Function ---
        function typeWriter(element, text, speed = 30) {
            let i = 0;
            element.innerHTML = ''; // Clear the element first
            const cursor = document.createElement('span');
            cursor.className = 'blinking-cursor';
            cursor.innerHTML = '&#9646;';
            element.appendChild(cursor);

            function typing() {
                if (i < text.length) {
                    const char = text.charAt(i);
                    if (char === '\n') {
                        element.insertBefore(document.createElement('br'), cursor);
                    } else {
                        element.insertBefore(document.createTextNode(char), cursor);
                    }
                    i++;
                    setTimeout(typing, speed);
                } else {
                    cursor.style.display = 'none'; // Remove cursor after typing
                }
            }
            typing();
        }

        // --- Data Display and Filtering Function ---
        function displayData(filter = '') {
            const dataOutputElement = document.getElementById('data-output');
            if (!dataOutputElement) return; // Exit if the element doesn't exist yet

            const searchTerm = filter.toLowerCase();
            const filteredData = allDistrictsData.filter(item =>
                item.district.toLowerCase().includes(searchTerm)
            );

            let dataString = 'District Wise Udyog Aadhaar Registration Details for Tamil Nadu:\n\n';
            if (filteredData.length === 0) {
                dataString += 'No districts found matching your search.';
            } else {
                filteredData.forEach(item => {
                    dataString += `${item.district.padEnd(20)}| Total: ${item.total.padStart(8)} | Micro: ${item.micro.padStart(8)} | Small: ${item.small.padStart(8)} | Medium: ${item.medium.padStart(8)}\n`;
                });
            }
            // Directly update text content for instant filtering without re-running typewriter
            dataOutputElement.textContent = dataString;
        }

        // --- Main Fetch and Process Logic ---
        fetchBtn.addEventListener('click', async () => {
            // 1. UI Setup on Click
            fetchBtn.disabled = true;
            loadingDiv.style.display = 'flex';
            outputDiv.innerHTML = '';
            allDistrictsData = []; // Reset data on new fetch

            try {
                // 2. Fetch HTML data using ScraperAPI
                const scraperUrl = `https://api.scraperapi.com?api_key=${scraperApiKey}&url=${encodeURIComponent(msmeUrl)}`;
                const response = await fetch(scraperUrl);
                if (!response.ok) {
                    throw new Error(`Network response error: ${response.statusText}`);
                }
                const html = await response.text();

                // 3. Parse HTML to extract table data
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const table = doc.querySelector('table');
                if (!table) {
                    throw new Error('Data table not found in the source HTML.');
                }

                // 4. Process Rows and Extract Data
                const rows = table.querySelectorAll('tr');
                let chennaiData = {};

                rows.forEach((row, index) => {
                    if (index === 0) return; // Skip header row
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 6) {
                        const district = cells[1].textContent.trim();
                        const total = cells[2].textContent.trim();
                        const micro = cells[3].textContent.trim();
                        const small = cells[4].textContent.trim();
                        const medium = cells[5].textContent.trim();
                        
                        allDistrictsData.push({ district, total, micro, small, medium });
                        
                        if (district.toUpperCase() === 'CHENNAI') {
                            chennaiData = { total, micro, small, medium };
                        }
                    }
                });

                // 5. Generate Business Pitch
                if (!chennaiData.total) {
                   throw new Error("Chennai data could not be extracted. Cannot generate pitch.");
                }
                
                let pitch = `Unlock the Potential: Start Your Small Tech Enterprise in Chennai!\n\n`;
                pitch += `Chennai boasts a vibrant MSME ecosystem with ${chennaiData.total} total registrations, including ${chennaiData.micro} micro, ${chennaiData.small} small, and ${chennaiData.medium} medium enterprises. This thriving environment offers immense opportunities for innovation in tech.\n\n`;
                pitch += 'Leverage government MSME schemes such as Udyam Registration for seamless setup, Credit Guarantee Fund Trust for funding support, and priority lending from banks. Benefit from subsidies, tax exemptions, and access to government tenders to scale your business.\n\n';
                pitch += 'Imagine launching your AI-driven software solutions or app development firm in Chennai\'s tech-savvy landscape, backed by skilled talent and robust infrastructure. With low entry barriers and high growth potential, now is the time to turn your tech idea into a successful venture.\n\n';
                pitch += 'Join the ranks of successful entrepreneurs – invest in Chennai\'s MSME boom today!';
                
                // 6. Display Results with typewriter effect
                outputDiv.innerHTML = `
                    <div class="bg-black/30 p-6 rounded-lg border border-cyan-500/30 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl text-cyan-300">Extracted Data Stream</h2>
                            <input type="text" id="searchInput" placeholder="Search for a district..." class="search-input w-1/2 md:w-1/3 p-2 rounded-md text-sm transition-all duration-300">
                        </div>
                        <pre class="text-gray-300 whitespace-pre-wrap font-mono text-sm leading-relaxed" id="data-output"></pre>
                    </div>
                    <div class="bg-black/30 p-6 rounded-lg border border-purple-500/30">
                        <h2 class="text-2xl text-purple-300 mb-4">AI-Generated Business Pitch</h2>
                        <p class="text-gray-300 whitespace-pre-wrap font-mono text-sm leading-relaxed" id="pitch-output"></p>
                    </div>
                `;
                
                // Initial data display with typewriter
                let initialDataString = 'District Wise Udyog Aadhaar Registration Details for Tamil Nadu:\n\n';
                allDistrictsData.forEach(item => {
                     initialDataString += `${item.district.padEnd(20)}| Total: ${item.total.padStart(8)} | Micro: ${item.micro.padStart(8)} | Small: ${item.small.padStart(8)} | Medium: ${item.medium.padStart(8)}\n`;
                });
                typeWriter(document.getElementById('data-output'), initialDataString, 5);
                typeWriter(document.getElementById('pitch-output'), pitch, 15);

                // Add event listener for the new search input
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    displayData(e.target.value);
                });

            } catch (error) {
                // 7. Error Handling
                outputDiv.innerHTML = `<p class="text-red-400 bg-red-900/50 p-4 rounded-lg"><strong>Error:</strong> ${error.message}</p>`;
            } finally {
                // 8. Final UI State
                fetchBtn.disabled = false;
                loadingDiv.style.display = 'none';
            }
        });

        // --- Animated Background Canvas Logic ---
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');

        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;

        const columns = Math.floor(width / 20);
        const drops = Array(columns).fill(1);
        const chars = "0123456789ABCDEF";

        function drawMatrix() {
            ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
            ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = '#00ffff';
            ctx.font = '15px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * 20, drops[i] * 20);

                if (drops[i] * 20 > height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        setInterval(drawMatrix, 40);

        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            const newColumns = Math.floor(width / 20);
            drops.length = 0;
            for (let i = 0; i < newColumns; i++) {
                drops.push(1);
            }
        });

    </script>
</body>
</html>
